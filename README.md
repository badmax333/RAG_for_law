# RAG for Law: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ –ü–î–î –†–§

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**RAG for Law** ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ **Corrective Retrieval-Augmented Generation (CRAG)** –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ü—Ä–∞–≤–∏–ª–∞—Ö –î–æ—Ä–æ–∂–Ω–æ–≥–æ –î–≤–∏–∂–µ–Ω–∏—è –†–§. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–æ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –µ–µ –ø–æ–ª–Ω–æ—Ç—É, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∏–π –ø–æ–∏—Å–∫ –∏ —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –ü–î–î.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **Corrective RAG (CRAG)**: –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–æ–π –∏ —Å–∞–º–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π
- **–¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫**: –†–∞–∑–¥–µ–ª—ã ‚Üí –ü—É–Ω–∫—Ç—ã ‚Üí –ü–æ–¥–ø—É–Ω–∫—Ç—ã
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ FAISS** –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ GPU/CPU** —Å –ø–æ–¥–±–æ—Ä–æ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç—ã–º –∏ —Å–ª–æ–∂–Ω—ã–º –ø–∞–π–ø–ª–∞–π–Ω–æ–º

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CRAG

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Corrective RAG ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤, –≥–¥–µ LLM –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫.

### –û–±—â–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ó–∞–ø—Ä–æ—Å
        ‚Üì
    Query Router (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   1. Retrieval (–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ)   ‚îÇ
‚îÇ   PDDRetriever                ‚îÇ
‚îÇ   - –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫       ‚îÇ
‚îÇ   - FAISS + Embeddings        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   2. Generation (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è)    ‚îÇ
‚îÇ   –ü—Ä–æ—Å—Ç–∞—è / CRAG (5 —à–∞–≥–æ–≤)     ‚îÇ
‚îÇ   - LLM: Mistral-7B / TinyLlama‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
    –§–∏–Ω–∞–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç + –ò—Å—Ç–æ—á–Ω–∏–∫–∏
```

### 1. –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π Retrieval

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: `sentence-transformers` (multilingual-e5-base), `FAISS`

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
1. **–ü–æ–∏—Å–∫ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º**: –ù–∞—Ö–æ–¥–∏–º —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é + –æ–ø–∏—Å–∞–Ω–∏—é
2. **–ü–æ–∏—Å–∫ –ø–æ –ø—É–Ω–∫—Ç–∞–º**: –ò—â–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –≤–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç—ã –∏–∑ —Ç–æ–ø-—Ä–∞–∑–¥–µ–ª–æ–≤, –ø–µ—Ä–µ-—Ä–∞–Ω–∂–∏—Ä—É–µ–º –ø–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É score

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `Document[]` —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Ä–∞–∑–¥–µ–ª, –ø—É–Ω–∫—Ç, scores)

### 2. Corrective Generation (CRAG)

**5-—à–∞–≥–æ–≤—ã–π –∫–∞—Å–∫–∞–¥ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π**:

1. **Initial Generation**: LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. **Critique & Decomposition**: LLM-–∫—Ä–∏—Ç–∏–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–µ–ª—ã –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç 1-3 –Ω–æ–≤—ã—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
3. **Iterative Retrieval**: –°–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–∞–º
4. **Final Synthesis**: LLM —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
5. **Factual Verification**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –æ—Ç–≤–µ—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–µ–π

–í—Å–µ —à–∞–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é **Pydantic-—Å—Ö–µ–º** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON-–æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM.

### 3. Query Router

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:
- **–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Üí –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑ CRAG
- **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Üí –ü–æ–ª–Ω—ã–π CRAG –ø–∞–π–ø–ª–∞–π–Ω

---

## üìä –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

**–î–æ–∫—É–º–µ–Ω—Ç**: [–ü–î–î –†–§ –Ω–∞ –í–∏–∫–∏—Ç–µ–∫–µ](https://ru.wikisource.org/wiki/–ü—Ä–∞–≤–∏–ª–∞_–¥–æ—Ä–æ–∂–Ω–æ–≥–æ_–¥–≤–∏–∂–µ–Ω–∏—è_–†–æ—Å—Å–∏–π—Å–∫–æ–π_–§–µ–¥–µ—Ä–∞—Ü–∏–∏)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- 30 —Ä–∞–∑–¥–µ–ª–æ–≤
- 208 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤
- 6 –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤

### –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–ü–∞—Ä—Å–∏–Ω–≥**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ `.docx` —Å –ø–æ–º–æ—â—å—é `python-docx` –∏ regex
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ä–∞–∑–¥–µ–ª ‚Üí –ø—É–Ω–∫—Ç ‚Üí –ø–æ–¥–ø—É–Ω–∫—Ç
3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏–π —Ä–∞–∑–¥–µ–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é LLM (DeepSeek v3.2)
4. **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∏–µ embeddings –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –ø—É–Ω–∫—Ç–æ–≤
5. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ FAISS –∏–Ω–¥–µ–∫—Å–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `data/pdd.json` + –∫—ç—à FAISS –∏–Ω–¥–µ–∫—Å–æ–≤

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

```json
[
  {
    "section": {
      "sec_num": "10",
      "name": "–û–±–≥–æ–Ω, –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ, –≤—Å—Ç—Ä–µ—á–Ω—ã–π —Ä–∞–∑—ä–µ–∑–¥",
      "description": "–†–∞–∑–¥–µ–ª —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–≥–æ–Ω–∞...",
      "content": [
        {
          "p_num": "10.1",
          "full_text": "–ü—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å –æ–±–≥–æ–Ω...",
          "p_sup": []
        }
      ]
    }
  }
]
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∏—Å–∫–∞

- **section_score**: –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å —Ä–∞–∑–¥–µ–ª–æ–º
- **content_score**: –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å –ø—É–Ω–∫—Ç–æ–º
- **combined_score**: `section_score_norm * content_score_norm`

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- 8GB RAM (–¥–ª—è CPU —Ä–µ–∂–∏–º–∞)
- CUDA-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `torch` ‚Äî –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è ML
- `transformers` ‚Äî –†–∞–±–æ—Ç–∞ —Å LLM
- `langchain` ‚Äî –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ RAG –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- `sentence-transformers` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ embeddings
- `faiss-cpu` ‚Äî –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- `bitsandbytes` ‚Äî –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (–¥–ª—è GPU)
- `accelerate` ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–µ–π

---

## üöÄ –ó–∞–ø—É—Å–∫

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º

```bash
python main.py
```

–°–∏—Å—Ç–µ–º–∞ –≤–æ–π–¥–µ—Ç –≤ —Ä–µ–∂–∏–º –¥–∏–∞–ª–æ–≥–∞, –≥–¥–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ü–î–î.

### –†–µ–∂–∏–º –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

```bash
python main.py "–ö–æ–≥–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ —Å—Ç–æ–ø-–ª–∏–Ω–∏–µ–π?"
```

### –û–ø—Ü–∏–∏

- `--top_k N` ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ–∫–∞–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `--trace` ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É CRAG-—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
- `--no-cache` ‚Äî –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤
- `--cache-stats` ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞

### –ü—Ä–∏–º–µ—Ä —Å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π

```bash
python main.py "–†–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –æ–±–≥–æ–Ω –Ω–∞ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–µ?" --trace
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RAG_for_law/
‚îú‚îÄ‚îÄ main.py                 # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ evaluate.py             # –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (ROUGE, LLM Judge)
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ pdd.json           # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ü–î–î
‚îÇ   ‚îî‚îÄ‚îÄ validation_set.jsonl # –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py        # RAGPipeline (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ retriever.py       # PDDRetriever (–ø–æ–∏—Å–∫)
‚îÇ   ‚îú‚îÄ‚îÄ chains.py          # CRAG –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ simple_chain.py    # –ü—Ä–æ—Å—Ç–∞—è —Ü–µ–ø–æ—á–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ router.py          # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ cache.py           # –ö—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py         # Pydantic —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ faiss_langchain_cache/ # FAISS –∏–Ω–¥–µ–∫—Å—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
```

---

## üìä –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

–°–∫—Ä–∏–ø—Ç `evaluate.py` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:

1. **ROUGE**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ç—Ä–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —ç—Ç–∞–ª–æ–Ω–æ–º
2. **LLM as a Judge**: –û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–Ω–æ—Ç—ã –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ LLM

```bash
python evaluate.py --use_llm_judge
```

---

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è CPU

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPU –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å:

### –° GPU
- **–ú–æ–¥–µ–ª—å**: Mistral-7B-Instruct-v0.2
- **–ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è**: 4-bit —á–µ—Ä–µ–∑ bitsandbytes
- **–ü–∞–º—è—Ç—å**: ~4GB VRAM
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –í—ã—Å–æ–∫–æ–µ

### –ë–µ–∑ GPU (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **–ú–æ–¥–µ–ª—å**: TinyLlama-1.1B-Chat
- **–ü–∞–º—è—Ç—å**: ~2GB RAM
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –¥–ª—è –ü–î–î

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è CPU

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `model_name` –≤ `src/pipeline.py:49`:

```python
# –î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ CPU:
model_name = "microsoft/phi-2"  # 2.7B, ~3GB RAM
# –∏–ª–∏
model_name = "google/gemma-2b-it"  # 2B, ~2GB RAM
```

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç:
1. 4-bit –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è (GPU)
2. 8-bit –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è (GPU)
3. Float16 —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ (CPU)
4. Float32 —Å –ª–µ–≥–∫–æ–π –º–æ–¥–µ–ª—å—é (CPU)

---

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CRAG –ø–æ–¥—Ö–æ–¥–∞

1. **–°–∞–º–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è**: LLM —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–µ–ª—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
2. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–§–∞–∫—Ç-—á–µ–∫–∏–Ω–≥**: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **Query Cache**: –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (TTL: 1 —á–∞—Å)
- **FAISS Cache**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: Hit rate, —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –†–µ–∂–∏–º | Latency | –ö–∞—á–µ—Å—Ç–≤–æ |
|-------|---------|----------|
| Simple (–±–µ–∑ CRAG) | ~2-3s | –•–æ—Ä–æ—à–µ–µ |
| CRAG (—Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π) | ~5-8s | –û—Ç–ª–∏—á–Ω–æ–µ |
| Cached | ~100ms | - |

---

## üöÄ Usage

### Telegram Bot
```bash
# Configure .env with your bot token and mistral api key!
# Then run:
docker compose --profile bot up -d --build
```

### Interactive CLI (Legacy)
```bash
docker compose run --rm rag-app python main.py "–ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ–±–≥–æ–Ω—è—Ç—å?"
```


## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] RAG Fusion –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–î–∞–Ω–Ω—ã–µ –ü–î–î –†–§ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.
